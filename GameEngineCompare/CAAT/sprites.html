<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<style>
    canvas{
        margin: 0 auto;
    }
    body{
        text-align: center;
    }
</style>
<body>
<canvas width="800" height="500" id="experiment-canvas"></canvas>

</body>
</html>

<script src="src/Core/ModuleManager.js"></script>
<script>
    window.addEventListener('load',load,false);


    function load() {
        CAAT.ModuleManager.
                baseURL("src/").
                setModulePath("CAAT.Core",              "Core").
                setModulePath("CAAT.Math",              "Math").
                setModulePath("CAAT.Behavior",          "Behavior").
                setModulePath("CAAT.Foundation",        "Foundation").
                setModulePath("CAAT.Event",             "Event").
                setModulePath("CAAT.PathUtil",          "PathUtil").
                setModulePath("CAAT.Module",            "Modules").
                setModulePath("CAAT.Module.Preloader",  "Modules/Image/Preloader").
                setModulePath("CAAT.WebGL",             "WebGL").

            // get modules, and solve their dependencies.
                bring(
                [
                    "CAAT.PathUtil.Path",
                    "CAAT.PathUtil.LinearPath",
                    "CAAT.Foundation.SpriteImage",
                    "CAAT.Foundation.Director",
                    "CAAT.Foundation.Actor",
                    "CAAT.Foundation.ActorContainer",
                    "CAAT.Behavior.PathBehavior",
                    "CAAT.Behavior.Interpolator",
                    "CAAT.Module.Preloader.Preloader"
                ]).

                onReady(function () {

                    new CAAT.Module.Preloader.Preloader().
                            addElement("fish",  "../resources/anim1.png").
                            addElement("fish2", "../resources/anim2.png").
                            addElement("fish3", "../resources/anim3.png").
                            addElement("fish4", "../resources/anim4.png").
                            load( function onAllAssetsLoaded(images) {
                                sprites(images);
                            } );

                });
    }

    function sprites(images){
        CAAT.DEBUG= 1;
        var director= new CAAT.Foundation.Director().initialize( 800,500,'experiment-canvas' );
        director.setImagesCache(images);
        director.renderMode = 0;

        var scene= director.createScene();

        scene.activated= function() {
            director.setClear(false);
        };

        var imageIndex=0;

        var conpoundimagefish = [];
        conpoundimagefish.push(
                new CAAT.Foundation.SpriteImage().initialize(
                        director.getImage('fish'),  1, 3) );

        function addFish(x, y){

            var fish = new CAAT.Foundation.Actor().
                    setBackgroundImage(
                    conpoundimagefish[0],
                    true).
                    setLocation( x,y ).
                    enableEvents(false);

            scene.addChild(fish);
        }


        var gradient= director.ctx.createLinearGradient(0,0,director.width,director.height);
        gradient.addColorStop(0,'#000000');

        var gr= new CAAT.Foundation.ActorContainer().
                setBounds(0,0,director.width,director.height).
                setFillStyle(gradient).
                enableEvents(false).
                cacheAsBitmap();

        scene.addChild(gr);

        gr.enableEvents(true);
        gr.mouseClick= function(ev) {
            addFish(ev.point.x,ev.point.y);
        };

        console.time("add 5000 sprites");
        for(var i=0;i<5000;i++){

            addFish( (i*50)%800,(((i/16) | 0) * 26) % 494 );
        }
        console.timeEnd("add 5000 sprites");


        CAAT.loop(60);
    }
</script>